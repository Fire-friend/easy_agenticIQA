# Pipeline Configuration
# This file defines the orchestration settings for the AgenticIQA pipeline

# Pipeline orchestration settings
pipeline:
  # Maximum number of replanning iterations
  max_replan: 2

  # Timeout settings (in seconds)
  timeout:
    planner: 60
    executor: 300
    summarizer: 60

  # Retry settings
  retry:
    max_attempts: 3
    backoff_factor: 2.0

  # Cache settings
  cache_dir: ${AGENTIC_LOG_ROOT:-logs}/cache
  enable_cache: true

  # Logging settings
  log_path: ${AGENTIC_LOG_ROOT:-logs}/pipeline.log
  log_level: INFO
  log_format: json  # Options: json, text

  # Checkpoint settings
  checkpoint:
    enable: true
    save_dir: ${AGENTIC_LOG_ROOT:-logs}/checkpoints
    save_interval: 10  # Save every N samples

# LangGraph settings
langgraph:
  # State management
  state_storage: ${LANGGRAPH_STORAGE:-memory}  # Options: memory, redis, postgres

  # Graph execution settings
  max_iterations: 10
  recursion_limit: 25

  # Debugging settings
  debug_mode: false
  save_graph_visualization: false

# Executor subtask settings
executor:
  # Distortion detection settings
  distortion_detection:
    enable: true
    confidence_threshold: 0.5

  # Distortion analysis settings
  distortion_analysis:
    enable: true
    analyze_severity: true

  # Tool selection settings
  tool_selection:
    enable: true
    max_tools: 5
    metadata_path: ${AGENTIC_TOOL_HOME:-iqa_tools}/metadata/tool_metadata.json

  # Tool execution settings
  tool_execution:
    enable: true
    score_normalization: true  # Normalize scores to 1-5 scale
    parallel_execution: false  # Run tools in parallel
    timeout: 120  # Timeout per tool in seconds

# Summarizer settings
summarizer:
  # Scoring fusion settings
  fusion:
    enable: true
    weight_tool_scores: 0.6
    weight_vlm_probability: 0.4

  # Replanning trigger settings
  replan_trigger:
    enable: true
    insufficient_evidence_threshold: 0.3

  # Output settings
  generate_explanation: true
  quality_reasoning_required: true

# Data processing settings
data:
  # Input data settings
  input_format: jsonl  # Options: jsonl, json, csv
  image_formats: [jpg, jpeg, png, bmp, tiff]

  # Output settings
  output_format: jsonl
  save_intermediate_results: true
  intermediate_dir: ${AGENTIC_LOG_ROOT:-logs}/intermediate

# Evaluation settings
evaluation:
  # Metrics to compute
  metrics:
    - mcq_accuracy
    - srcc
    - plcc
    - krcc

  # Evaluation datasets
  datasets:
    agenticiqa_eval:
      path: ${AGENTIC_DATA_ROOT:-data}/processed/agenticiqa_eval
      type: mcq
    tid2013:
      path: ${AGENTIC_DATA_ROOT:-data}/processed/tid2013
      type: scoring
    bid:
      path: ${AGENTIC_DATA_ROOT:-data}/processed/bid
      type: scoring
    agiqa_3k:
      path: ${AGENTIC_DATA_ROOT:-data}/processed/agiqa_3k
      type: scoring

# Resource management
resources:
  # GPU settings
  gpu:
    enable: true
    device_ids: [0]  # GPU device IDs to use
    memory_fraction: 0.9

  # Batch processing
  batch:
    enable: false
    batch_size: 1

  # Memory management
  memory:
    clear_cache_interval: 100  # Clear cache every N samples
